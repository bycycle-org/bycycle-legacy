% if not c.wrap:
  ${self.body()}
% else:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  ${h.if_ie('<xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"/>')}


  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />

    <meta name="author" content="Wyatt Baldwin, wyatt@byCycle.org" />

    <meta name="keywords" content="bicycle, bike, bicycle trip planner, bicycle route finder, bike trip planner, bike route finder, bicycle route, bicycle trip, bike route, bike trip, bicycle routing, bike routing, maps, bicycle maps, bike maps, bicycle advocacy, community, sustainability, portland, oregon, milwaukee, wisconsin" />

    <meta name="description" content="byCycle.org Bicycle Trip Planner -- A web-based, interactive, bicycle trip planner (route finder) for the Portland, Oregon, Milwaukee, Wisconsin, and, soon, other regions." />

    <title>byCycle.org - Bicycle Trip Planner - ${self.region_title()}</title>

    ${h.stylesheet_link_tag('base.css', 'fixed-pane.css')}
    ${h.if_ie(h.stylesheet_link_tag('base_ie.css'))}
    ${self.stylesheet_links()}

    <script type="text/javascript">
      //<![CDATA[
      // Global setup
      var debug = ${'true' if bool(g.debug) else 'false'};
      byCycle_prefix = '${h.url_for('/')}';
      //]]>
    </script>

    ${h.javascript_include_tag('prototype')}
    ${h.javascript_include_tag('bycycle', 'util')}
  </head>


  <body>


    <div id="meta">
      <div id="current-region">
        Region:
        ${self.region_title()}
        % if c.region:
          ${h.link_to('change', h.url_for('regions'))}
        % endif
      </div>

      <div id="meta-links">
        <a href="http://bycycle.org/projects/trip-planner/help"
           title="Trip Planner help page (opens in new window)"
           target="byCyle_window"
           >Help</a>
        &middot;
        <a href="http://bycycle.org/contact"
           title="Send us your comments, questions, suggestions, etc (opens in new window)"
           target="byCyle_window"
           >Feedback</a>
      </div>
    </div>
    <!-- /#meta -->


    <div id="wrapper">


      <!-- Masthead -->
      <div id="masthead">
        <h1 id="logo">
          <a href="http://bycycle.org/" title="byCycle.org Home Page">
          ${h.image_tag('/images/logo.png', title='byCycle.org Home Page', width=150, height=25, alt='byCycle.org')}
          </a>
        </h1>

        <h2 id="app-name">
          ${h.link_to('Bicycle Trip Planner', h.url_for('/'), title='byCycle.org Bicycle Trip Planner')}
        </h2>

        <h3 id="app-version">
          <a href="http://en.wikipedia.org/wiki/Development_stage#Beta"
             title="Beta?"
             >beta</a>
        </h3>
      </div>
      <!-- /Masthead -->


      <%call expr="self.input_container()" />


      <div class="clear"></div>


      <!-- Bar -->
      <div id="bar">


        <div id="status">
          % if c.status:
            ${c.status}
          % else:
            Welcome to the
            <a href="http://bycycle.org/"
               title="byCycle Home Page (opens in new window)"
               target="byCyle_window"
               >byCycle.org</a> bicycle trip planner.
          % endif
        </div>


        <!-- Links -->
        <div id="links">
          ${self.links()}
        </div>
        <!-- /Links -->


        <div class="clear"></div>
      </div>
      <!-- /Bar -->


      <!-- Content -->
      <div id="content">


        <!-- Column A -->
        <div id="col-a">


          <div id="spinner" class="spinner" style="display: none;">
            ${h.image_tag('spinner.gif', width=16, height=16)}
          </div>


          <!-- Message Pane -->
          <div id="message_pane" class="display-pane fixed-pane"
               ${'style="display: none;"' if (c.http_status and not c.errors) else ''}>

            <div class="title-bar"><div class="title">&nbsp;</div></div>

            <div class="content-pane">

              <div id="info_pane"
                   ${'style="display: none;"' if c.errors else ''}>

                % if c.info:
                  ${c.info}
                % else:
                  <p class="no-top-margin">
                    The trip planner is under active development. Please
                    <a href="http://bycycle.org/contact"
                       title="Send us problems, comments, questions, &amp; suggestions (opens in new window)"
                       target="byCyle_window"
                       >contact us</a>
                       with any problems, comments, questions, or suggestions.
                  </p>

                  <p>
                    If you find this application useful or would like to contribute to its improvement, please consider
                    <a href="http://bycycle.org/support/donate"
                       title="Support byCycle (opens in new window)"
                       target="byCyle_window">donating</a>,
                    <a href="http://bycycle.org/support/buy-stuff"
                       title="Buy byCycle stuff"
                       target="byCyle_window">buying our apparel and other items</a>, or
                    <a href="http://bycycle.org/support/get-involved"
                       title="Get Involved"
                       target="byCyclewindow">getting involved</a>.
                  </p>

                  <p class="no-bottom-margin">
                    Users should independently verify all information presented here. This
                    service is provided <b>AS IS</b> with <b>NO WARRANTY</b> of any kind.
                    <em>Please be careful out there.</em>
                  </p>
                % endif
              </div>

              <div id="error_pane" ${'style="display: none;"' if not c.errors else ''}>
                ${c.errors}
              </div>
            </div>
          </div>
          <!-- /Message Pane -->


          <%call expr="self.result_pane()" />


        </div>
        <!-- /Column A -->


        <!-- Column B -->
        <div id="col-b">


          <%call expr="self.map_controls()" />


          <!-- Map -->
          <div id="map_pane">
            <div id="map_message" style="display: none; padding: 5px;">
              You will need to update to a recent version of Internet Explorer, Firefox, or Safari to view the map.
            </div>
          </div>
          <!-- /Map -->


        </div>
        <!-- /Column B -->


        <div class="clear"></div>
      </div>
      <!-- /Content -->


      <!-- Ads -->
      <div id="ads" class="fixed-pane">
        <div class="title-bar">
          <div class="title">&nbsp;</div>
        </div>
        <div class="content-pane">
          ${self.ads()}
          ${h.javascript_include_tag('ads')}
        </div>
      </div>
      <!-- /Ads -->


    </div>
    <!-- /Wrapper -->


    <!-- Footer -->
    <div id="footer">
      &copy; 2007 <a href="http://byCycle.org/" title="byCycle Home Page">byCycle.org</a>
      &middot;
      Hosted by <a href="http://www.metro-region.org/">Metro</a>
      &middot;
      <a href="http://trac.bycycle.org/" title="Information for Developers (Trac)">Developers</a>
      &middot;
      Powered by <a href="http://www.python.org/">Python</a> and
      <a href="http://pylonshq.com/">Pylons</a>
    </div>
    <!-- /Footer -->


    <!-- Loading -->
    <div id="loading" style="display: none;">
      <div id="loading-masthead">
        <a href="http://bycycle.org/" title="byCycle.org Home Page">
          ${h.image_tag('http://tripplanner.bycycle.org/public/images/logo.png', title='byCycle.org Home Page', width=150, height=40, alt='byCycle.org')}
        </a>
      </div>

      <h2>Bicycle Trip Planner</h2>

      <div>
        <div class="spinner">
          ${h.image_tag('spinner.gif', width=16, height=16)}
        </div>
        <h2>
          Loading. Please wait...
        </h2>
        <p id="loading_status"></p>
      </div>
    </div>
    <!-- /Loading -->


    ${h.javascript_include_tag('map', 'gmap', 'widgets/fixed_pane', 'ui', 'regions')}
    ${self.javascript_includes()}


    <script type="text/javascript">
      //<![CDATA[
      // Set up for initialization
      byCycle.UI.beforeLoad();
      ${self.javascript()}
      //]]>
    </script>


    <!-- TODO: Maybe we could get this dynamically the first time it's needed? -->
    <%include file="/_center_marker.html" />


  </body>
</html>


<%def name="region_title()">
  ${c.region.title if c.region else 'Select a region'}
</%def>


## Layout Methods

<%def name="stylesheet_links()"></%def>

<%def name="input_container(classes=[])">
  <!-- Input Container -->
  <div id="input_container" class="${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Input Container -->
</%def>

<%def name="links()"></%def>

<%def name="result_pane(classes=[])">
  <!-- Result Pane -->
  <div id="result_pane" class="display-pane ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Result Pane -->
</%def>

<%def name="map_controls()"></%def>
<%def name="javascript_includes()"></%def>
<%def name="javascript()"></%def>
<%def name="ads()">
  % if c.region:
    <% region_ns = self.get_namespace('/regions/%s.html' % c.region.slug) %>
    ${region_ns.ads()}
  % endif
</%def>


## End Layout Methods


<%def name="make_tab_buttons(tab_ids, selected='')">
  <%doc>
    Make the 'tab buttons' for a tab control (a set of LIs)
    ``tab_ids`` is one or more strings suitable for a URL hash (like tab-id-13)
    Each generated LI has class 'tab-button'
    Each LI has an A element that has href='#tab-id'
    The A element's link text and title attribute are 'Tab Id'
  </%doc>
  % for t in tab_ids:
    <%
      link_text = t.replace('-', ' ').capitalize()
      css_class = 'selected-tab-button' if t == selected else ''
    %>
<li class="tab-button ${css_class}">${h.link_to(link_text, '#%s' % t, title=link_text)}</li>\
  % endfor
</%def>


% endif ## if not c.wrap
