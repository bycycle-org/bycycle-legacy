% if not c.wrap:
  ${self.body()}
% else:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  ${h.if_ie('<xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"/>')}

  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />

    <meta name="author" content="Wyatt Baldwin, wyatt@byCycle.org" />

    <meta name="keywords" content="bicycle, bike, bicycle trip planner, bicycle route finder, bike trip planner, bike route finder, bicycle route, bicycle trip, bike route, bike trip, bicycle routing, bike routing, maps, bicycle maps, bike maps, bicycle advocacy, community, sustainability, portland, oregon, milwaukee, wisconsin" />

    <meta name="description" content="byCycle.org Bicycle Trip Planner -- A web-based, interactive, bicycle trip planner (route finder) for the Portland, Oregon, Milwaukee, Wisconsin, and, soon, other regions." />

    <title>byCycle.org - Bicycle Trip Planner - ${self.region_title()}</title>

    ${h.stylesheet_link_tag('http://yui.yahooapis.com/2.2.2/build/reset-fonts-grids/reset-fonts-grids.css')}
    ${h.stylesheet_link_tag('base', 'fixed-pane')}
    ${h.if_ie(h.stylesheet_link_tag('base_ie'))}
    ${h.stylesheet_link_tag('print', media='print')}
    ${self.stylesheet_links()}

    <script type="text/javascript">
      //<![CDATA[
      // Global setup
      var debug = ${'true' if bool(g.debug) else 'false'};
      byCycle_prefix = '${h.url_for('/')}';
      //]]>
    </script>

    ${h.javascript_include_tag('prototype')}
    ${h.javascript_include_tag('bycycle', 'util')}
    
    <style>
      #doc3 {
        margin: auto;
      }
      #hd {
        background: gray;
      }
    </style>
  </head>


  <body>
    <div id="doc3" class="yui-t4">
      <div id="hd">
        MENU/NAV
      </div>
      <!-- /hd -->

      <div id="bd">
        <div id="yui-main">
          <div class="yui-b" style="margin-right: 120px;">
            <div class="yui-gd">
              <div class="yui-u first">
              
                <!-- Message Pane -->
                <%
                  show_msg_pane = (not c.http_status or c.info or c.exception or
                                   (c.http_status and c.http_status > 299))
                  show_error_pane = (c.exception or
                                     (c.http_status and c.http_status > 299))
                  show_info_pane = not show_error_pane
                  msg_pane_style = {'display': ('block' if show_msg_pane else 'none')}
                %>
      
                <%call expr="fixed_pane(id='message_pane', classes=['display-pane'], style=msg_pane_style)">
                  <div id="info_pane" ${h.hide_element(not show_info_pane)}>
                    % if c.info:
                      ${c.info}
                    % else:
                      <p class="no-top-margin">
                        This application is under active development. Please
                        <a href="http://bycycle.org/contact"
                           title="Send us problems, comments, questions, &amp; suggestions (opens in new window)"
                           target="_blank"
                           >contact us</a>
                           with any problems, comments, questions, or
                           suggestions.
                      </p>
      
                      <%include file="/widgets/paypal-button.html" />
      
                      <p class="no-bottom-margin">
                        Users should independently verify all information presented here. This
                        service is provided <b>AS IS</b> with <b>NO WARRANTY</b> of any kind.
                        <em>Please be careful out there.</em>
                      </p>
                    % endif
                  </div>
      
                  <div id="error_pane" ${h.hide_element(not show_error_pane)}>
                    ${self.body()}
                  </div>
                </%call>
                <!-- /Message Pane -->
      
      
                <%call expr="self.result_pane()" />
              </div>

              <div id="map_pane" class="yui-u" style="margin: 0; background: #99b3cc;">
                Map<br/>
                Map<br/>
                Map<br/>
              </div>
            </div>
          </div>
        </div>
        <!-- /yui-main -->
        
        <div class="yui-b" style="width: 120px;">
          ${self.ads()}
          ${h.javascript_include_tag('ads') if (g.debug) else ('Ads<br/>' * 10)}
        </div>
      </div>
      <!-- /bd -->
    </div>
    <!-- /doc -->

    <div id="map-buttons" style="display: none;">
      <div
        id="legend-map-button"
        class="map-button noprint"
        title="Pop up bike map legend"
        >
          <div class="map-button-inner">
            Bike map legend
          </div>
      </div>
    </div>

    ${h.javascript_include_tag('map', 'gmap', 'widgets/fixed_pane', 'ui', 'regions')}
    ${self.javascript_includes()}

    <script type="text/javascript">
      //<![CDATA[
      // Set up for initialization
      byCycle.UI.beforeLoad();
      ${self.javascript()}
      //]]>
    </script>

    <!-- TODO: Maybe we could get this dynamically the first time it's needed? -->
    <%include file="/widgets/center_marker.html" />
  </body>
</html>


<%namespace file="/widgets/fixed-pane.html" import="fixed_pane" />

<%def name="region_title()">
  ${c.region.title if c.region else ''}
</%def>

<%def name="stylesheet_links()"></%def>

<%def name="input_container(classes=[])">
  <!-- Input Container -->
  <div id="input_container" class="noprint ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Input Container -->
</%def>

<%def name="links()"></%def>

<%def name="result_pane(classes=[])">
  <!-- Result Pane -->
  <div id="result_pane" class="display-pane ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Result Pane -->
</%def>

<%def name="map_controls()"></%def>
<%def name="javascript_includes()"></%def>
<%def name="javascript()"></%def>

<%def name="ads()">
  <% region = c.region %>
  % if region and region.ads:
    <div id="region-ads">
      <h2>Local Stuff</h2>
      % for ad in region.ads:
        <div class="region-ad">
          <a href="${ad.href}"
             title="${ad.title}"
             target="byCycle-ad-link"
             >${ad.link_text}</a>
          <br/>
          ${ad.text}
        </div>
      % endfor
    </div>
  % endif
</%def>

<%def name="errors()">
  <div class="errors">
    <h2>${getattr(c.exception, 'title', 'Error')}</h2>
    % if hasattr(c.exception, 'errors'):
      % for error in c.exception.errors:
        <p class="error">
          ${error}
        </p>
      % endfor
    % else:
      <p class="error">
        ${c.exception.description}
      </p>
    % endif
    <% explanation = getattr(c.exception, 'explanation', None) %>
    % if explanation is not None:
      <div class="explanation">
        <h3>What This Means</h3>
        <p>${explanation.strip().replace('\n', '</p><p>')}</p>
      </div>
    % endif
  </div>
</%def>


% endif ## if not c.wrap
