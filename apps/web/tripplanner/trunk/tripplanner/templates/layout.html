## -*- coding: UTF-8 -*-
% if not c.wrap:
  ${next.body()}
% else:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  ${h.if_ie('<xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"/>')}

  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />

    <meta name="author" content="Wyatt Baldwin, wyatt@byCycle.org" />

    <meta name="keywords" content="bicycle, bike, bicycle trip planner, bicycle route finder, bike trip planner, bike route finder, bicycle route, bicycle trip, bike route, bike trip, bicycle routing, bike routing, maps, bicycle maps, bike maps, bicycle advocacy, community, sustainability, portland, oregon, milwaukee, wisconsin" />

    <meta name="description" content="byCycle.org Bicycle Trip Planner -- A web-based, interactive, bicycle trip planner (route finder) for the Portland, Oregon, Milwaukee, Wisconsin, and, soon, other regions." />

    <title>byCycle.org - Bicycle Trip Planner - ${self.region_title()}</title>

    ${h.stylesheet_link('/stylesheets/reset.css')}
    ${h.stylesheet_link('/stylesheets/base.css')}
    ${h.if_ie(h.stylesheet_link('/stylesheets/base_ie.css'))}
    ${h.stylesheet_link('/ui-theme/theme.css')}
    ${h.stylesheet_link('/stylesheets/print.css', media='print')}
    ${self.stylesheet_links()}
  </head>

  <body>

    <div id="wrapper">

      <!-- Header -->
      <div id="header">
		${h.link_to('Home', h.url_for('/'), title='byCycle.org Home')} |
		${h.link_to('About', h.url_for('about'), title='About byCycle.org')} |
		${h.link_to('Help', h.url_for('help'), title='Help')}
      </div>
      <!-- /Header -->

      <!-- Content -->
      <div id="content">

        <!-- Column A -->
        <div id="col-a">

          <!-- Controls -->
          ${self.controls()}

        </div>
        <!-- /Column A -->

        <!-- Column B -->
        <div id="col-b">

          <!-- Map -->
          <div id="map_pane"></div>

        </div>
        <!-- /Column B -->

        <div class="clear"></div>
      </div>
      <!-- /Content -->

      <div id="spinner" class="spinner noprint">
        ${h.image('spinner.gif', width=16, height=16, alt='Click to hide')}
      </div>

      <%call expr="dialog.dialog('errors', 'Oops!')">
        <div id="error_content"></div>
      </%call>
    </div>
    <!-- /Wrapper -->

	<script type="text/javascript">
      //<![CDATA[
      var debug = ${'true' if bool(g.debug) else 'false'};
      //]]>
    </script>

    ${h.javascript_link(
        '/javascripts/jquery.js',
        '/javascripts/jquery-ui.js',
        '/javascripts/util.js',
        '/javascripts/bycycle.js',
        '/javascripts/map.js',
        '/javascripts/regions.js',
	)}

	<script type="text/javascript">
      //<![CDATA[
      byCycle.prefix = '${h.url_for('/')}';
	  byCycle.region_id = '${c.region.slug if c.region else ''}';

	  // Get regions
	  jQuery.ajax({
		async: false,
		url: '/regions',
		data: {format: 'json'},
		dataType: 'json',
		success: byCycle.regions.initialize
	  });
	  if (byCycle.region_id) {
		byCycle.region = byCycle.regions.regions[byCycle.region_id];
	  } else {
		byCycle.region_id = 'all';
		byCycle.region = byCycle.regions[byCycle.region_id];
	  }

	  // Load map type namespace
	  window.$ = null;  // In case the map's JS library uses $
	  util.writeScript('/javascripts/' + byCycle.region.map_type + '.js');
      //]]>
    </script>

	${h.javascript_link(
	  '/javascripts/ui.js',
	  '/javascripts/query.js',
	  '/javascripts/result.js',
	)}

	<script type="text/javascript">
      //<![CDATA[
	  window.$j = jQuery.noConflict();
	  byCycle.UI.beforeLoad();
	  byCycle.UI.service = '${c.service}';
	  byCycle.UI.member_name = '${c.member_name}';
	  byCycle.UI.collection_name = '${c.collection_name}';
	  byCycle.UI.http_status = ${'%i' % c.http_status if c.http_status else 'undefined'};
	  byCycle.UI.q = '${c.q}';
      //]]>
    </script>

    <!-- TODO: Maybe we could get this dynamically the first time it's needed? -->
    <%include file="/widgets/center_marker.html" />

	% if not g.debug:
      <%include file="_google_analytics.html" />
	% endif
  </body>
</html>

<%namespace name="accordion" file="/widgets/accordion.html" />
<%namespace name="dialog" file="/widgets/dialog.html" />

<%def name="region_title()">
  ${c.region.title if c.region else 'Select a region'}
</%def>

<%def name="stylesheet_links()"></%def>

<%def name="input_container(classes=[])">
  <!-- Input Container -->
  <div id="input_container" class="noprint ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Input Container -->
</%def>

<%def name="links()"></%def>

<%def name="controls()">
  <%call expr="accordion.accordion_group('About')">
	This is an alternative transportation trip planner and data resource.
	Currently, the focus is on trips made <i>by bike</i>, but we are also
	starting to add some public transit info. To learn more about byCycle,
	${h.link_to(
		'click here', 'http://info.bycycle.org/about',
		title='About byCycle.org')}.
	<br />
	<br />
	The
	${h.link_to(
	  'source code', h.url_for('code'),
	  title='byCycle source repository (Subversion)')}
	  for this application is licensed under the
	${h.link_to(
	  'GNU General Public License, v3', h.url_for('gpl'), title='License')}.
	<br />
	<br />
	Their is a ${h.link_to(
	  'project Web site', h.url_for('project'),
	  title='byCycle project site (Trac)')}
	  for software developers.
	<br />
	<br />
	&copy; 2004-2008 byCycle.org.
  </%call>

  <%call expr="accordion.accordion_group('Support byCycle')">
	byCycle's only funding comes from users like you. We need your support
	to keep the trip planner up and running. You can donate through PayPal
	by clicking the button below, or you can visit our
	${h.link_to(
	  'support page', 'http://info.bycycle.org/support/',
	  title='Support byCycle')}
	to find other ways of supporting byCycle.

	<%include file="/widgets/paypal-button.html" />
  </%call>

  <%call expr="accordion.accordion_group('Contact Us')">
	Feel free to get in touch. We're open to any sort of constructive
	criticism. Please bear in mind, though, that this project has no funding
	or employees. It is maintained by volunteers. Please send all feedback
	to <a href="mailto:contact@bycycle.org">contact@bycycle.org</a>.
  </%call>
</%def>

<%def name="errors()"></%def>

<%def name="map_controls()"></%def>
<%def name="javascript_includes()"></%def>
<%def name="javascript()"></%def>

<%def name="json()">
  % if c.format != 'json':
    ${h.hidden(None, value=c.json, class_='json')}
  % endif
</%def>

% endif ## if not c.wrap
