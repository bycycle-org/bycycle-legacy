## -*- coding: UTF-8 -*-
% if not c.wrap:
  ${next.body()}
% else:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  ${h.if_ie('<xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"/>')}

  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <meta name="author" content="Wyatt Lee Baldwin, wyatt@byCycle.org" />
    <meta name="keywords" content="bicycle, bike, bicycle trip planner, bicycle route finder, bike trip planner, bike route finder, bicycle route, bicycle trip, bike route, bike trip, bicycle routing, bike routing, maps, bicycle maps, bike maps, bicycle advocacy, community, sustainability, portland, oregon, milwaukee, wisconsin" />
    <meta name="description" content="byCycle.org Bicycle Trip Planner -- A web-based, interactive, bicycle trip planner (route finder) for the Portland, Oregon, Milwaukee, Wisconsin, and, soon, other regions." />

    <title>byCycle.org - Bicycle Trip Planner - ${self.region_title()}</title>

    <link rel="shortcut icon" href="${h.url_for('/favicon.ico')}" type="image/x-icon" />

    <style type="text/css">
      html, body {
        overflow: hidden;
        height: 100%;
      }
      #loading {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: #fff;
        z-index: 9999999;
        border-collapse: collapse;
      }
      #loading td {
        text-align: center;
        vertical-align: middle;
        width: 100%;
        height: 100%;
      }
      #loading td h1 {
        font-weight: bold;
        font-size: 120%;
        font-family: arial,helvetica,clean,sans-serif;
        margin-top: .5em;
      }
    </style>
  </head>

  <body class="yui-skin-sam">

    <!-- Loading indicator... -->
    <table id="loading">
      <tbody>
        <tr>
          <td>
            <img src="${h.url_for('/images/spinner.gif')}" width="32" height="32" alt="Loading..." />
            <h1>Loading...</h1>
          </td>
        </tr>
      </tbody>
    </table>

    <div id="top">
      ${h.link_to('Home', h.url_for('/'), title='byCycle.org Home')} |
      ${h.link_to('About', h.url_for('about'), title='About byCycle.org')} |
      ${h.link_to('Help', h.url_for('help'), title='Help')}
    </div>

    <div id="left">
      <div id="controls" class="yui-navset">
        <ul class="yui-nav menu">
          ${self.controls_nav()}
        </ul>
        <div class="yui-content main">
          ${self.controls()}
        </div>
      </div>
    </div>

    <div id="center">
      <div id="map_pane">
        <!-- Map gets inserted here. -->
      </div>

      <div id="spinner" class="spinner noprint">
        <img src="${h.url_for('/images/spinner.gif')}" width="32" height="32" alt="*" />
      </div>
    </div>

    <script type="text/javascript" src="${h.url_for('/javascripts/init.js')}" ></script>
    <script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/yuiloader/yuiloader-min.js" ></script>
    <script type="text/javascript">
      //<![CDATA[
      var debug = ${'true' if bool(g.debug) else 'false'};
      var my_region_id = '${c.region.slug if c.region else ""}';

      INIT.initialize(my_region_id);

      var loader = new YAHOO.util.YUILoader({
        require: [
          'layout', 'container', 'button', 'tabview',
          'dom', 'event',  'element',
          'get', 'connection', 'json',
          'reset', 'fonts', 'grids', 'base', 'resize'
        ],
        allowRollup: true,
        combine: true,
        onSuccess: function () {
          // Called after all modules loaded are loaded by YUI. Only
          // initialization that MUST be done here should. All other
          // initialization should happen in or via `APP.onLoad`.
          APP.prefix = '${h.url_for("/")}';
          APP.region_id = my_region_id;
          APP.UI.service = '${c.service}';
          APP.UI.member_name = '${c.member_name}';
          APP.UI.collection_name = '${c.collection_name}';
          APP.UI.http_status = ${c.http_status or 'null'};
          APP.UI.q = '${c.q}';
          APP.onLoad();
        }
      });

      loader.addModule({
        name: 'my_base_css',
        type: 'css',
        fullpath: '${h.url_for("/stylesheets/base.css")}',
        requires: ['base']
      });

      loader.addModule({
        name: 'my_util',
        type: 'js',
        fullpath: '${h.url_for("/javascripts/util.js")}'
      });

      loader.addModule({
        name: 'APP',
        type: 'js',
        fullpath: '${h.url_for("/javascripts/bycycle.js")}',
        requires: ['my_util']
      });

      loader.addModule({
        name: 'my_map',
        type: 'js',
        fullpath: '${h.url_for("/javascripts/map.js")}',
        requires: ['APP']
      });

      loader.addModule({
        name: 'my_regions',
        type: 'js',
        fullpath: '${h.url_for("/javascripts/regions.js")}',
        requires: ['my_map']
      });

      loader.addModule({
        name: 'my_ui',
        type: 'js',
        fullpath: '${h.url_for("/javascripts/ui.js")}',
        requires: ['my_regions']
      });

      loader.addModule({
        name: 'my_query',
        type: 'js',
        fullpath: '${h.url_for("/javascripts/query.js")}',
        requires: ['my_ui']
      });

      loader.addModule({
        name: 'my_result',
        type: 'js',
        fullpath: '${h.url_for("/javascripts/result.js")}',
        requires: ['my_ui']
      });

      loader.require('my_base_css');
      loader.require('APP');
      loader.require('my_map');
      loader.require('my_regions');
      loader.require('my_ui');
      loader.require('my_query');
      loader.require('my_result');
      loader.insert();
      //]]>
    </script>

    % if not g.debug:
      <%include file="_google_analytics.html" />
    % endif
  </body>
</html>

<%namespace name="accordion" file="/widgets/accordion.html" />

<%def name="region_title()">
  ${c.region.title if c.region else 'Select a region'}
</%def>

<%def name="controls_nav()">
  <li><a href="#about-bycycle"><em>About</em></a></li>
  <li><a href="#support-bycycle"><em>Support byCycle</em></a></li>
  <li><a href="#contact-bycycle"><em>Contact Us</em></a></li>
</%def>

<%def name="controls()">
  <div id="about-bycycle">
    This is an alternative transportation trip planner and data resource.
    Currently, the focus is on trips made <i>by bike</i>, but we are also
    starting to add some public transit info. To learn more about byCycle,
    ${h.link_to(
      'click here', 'http://info.bycycle.org/about',
      title='About byCycle.org')}.
    <br />
    <br />
    The
    ${h.link_to(
      'source code', h.url_for('code'),
      title='byCycle source repository (Subversion)')}
      for this application is licensed under the
    ${h.link_to(
      'GNU General Public License, v3', h.url_for('gpl'), title='License')}.
    <br />
    <br />
    There is a ${h.link_to(
      'project Web site', h.url_for('project'),
      title='byCycle project site (Trac)')}
      for software developers.
    <br />
    <br />
    &copy; 2004-2008 byCycle.org.
  </div>

  <div id="support-bycycle">
    byCycle's only funding comes from users like you. We need your support
    to keep the trip planner up and running. You can donate through PayPal
    by clicking the button below, or you can visit our
    ${h.link_to(
      'support page', 'http://info.bycycle.org/support/',
      title='Support byCycle')}
    to find other ways of supporting byCycle.

    <%include file="/widgets/paypal-button.html" />
  </div>

  <div id="contact-bycycle">
    Feel free to get in touch. We're open to any sort of constructive
    criticism. Please bear in mind, though, that this project has no funding
    or employees. It is maintained by volunteers. Please send all feedback
    to <a href="mailto:contact@bycycle.org">contact@bycycle.org</a>.
  </div>
</%def>

<%def name="json()">
  % if c.format != 'json':
    ${h.hidden(None, value=c.json, class_='json')}
  % endif
</%def>

% endif ## if not c.wrap
